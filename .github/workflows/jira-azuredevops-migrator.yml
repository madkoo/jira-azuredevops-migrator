
name: jira-azuredevops-migrator 


on:
  pull_request:
    branches: 
      - master
      - feature/**
  push:
    branches: 
    - master
    - feature/**
jobs:
  build:
    
    strategy:
      matrix:
        configuration: [Release]
    
    runs-on: windows-latest
    
    env: 
      Solution_Name: src/WorkItemMigrator/WorkItemMigrator.sln
      Configuration: Release
    
    steps:
    - name: "Checkout" 
      uses: actions/checkout@master
      
      
   # Install the .NET Core workload
    - name: Install .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 3.1.101

    # Add  MSBuild to the PATH: https://github.com/microsoft/setup-msbuild
    - name: Setup MSBuild.exe
      uses: microsoft/setup-msbuild@2008f912f56e61277eefaac6d1888b750582aa16  
      
    # - name: setup-msbuild
      #uses: microsoft/setup-msbuild@v1
    
    - name: Setup Nuget.exe
      uses: warrenbuckley/Setup-Nuget@v1  
      
    - name: Restore NuGet Packages
      run: nuget restore src/WorkItemMigrator/WorkItemMigrator.sln
      
    - name: Build migrator
      run: msbuild $env:Solution_Name /p:Configuration=$env:Configuration
      env:
        CI: true
        
    - name: npm install tfx, build extension
      run: | 
        npm install -g tfx-cli
        tfx extension create -r src/WorkItemMigrator.Extension --output-path  bin\Release\PublishExt
      
    # - name: Build migrator.extenison
        
   # - name: Publish build artifact
    #  uses: actions/upload-artifact@v1.0.0
     # with:
      #  name: published_webapp
       # path: bin\Release\Publish    
